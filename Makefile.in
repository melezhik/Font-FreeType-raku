SRC=src

all : lib

# 'all', with compilation warnings and debug symbols enabled
debug :
	%MAKE% "CF=-Wall -g"  all

lib : resources/libraries/%LIB-NAME%

resources/libraries/%LIB-NAME% : $(SRC)/ft6_outline%O% $(SRC)/ft6_glyph%O% $(SRC)/ft6_glyphslot%O%
	%LD% %LDSHARED% %LDFLAGS% %LDOUT%resources/libraries/%LIB-NAME% $(SRC)/ft6_outline%O% $(SRC)/ft6_glyph%O% $(SRC)/ft6_glyphslot%O% %LIB-LDFLAGS% $(CF)

$(SRC)/ft6_outline%O% : $(SRC)/ft6_outline.c $(SRC)/ft6_outline.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/ft6_outline%O% $(SRC)/ft6_outline.c %LIB-CFLAGS% $(CF)

$(SRC)/ft6_glyph%O% : $(SRC)/ft6_glyph.c $(SRC)/ft6_glyph.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/ft6_glyph%O% $(SRC)/ft6_glyph.c %LIB-CFLAGS% $(CF)

$(SRC)/ft6_glyphslot%O% : $(SRC)/ft6_glyphslot.c $(SRC)/ft6_glyphslot.h
	%CC% -I $(SRC) -c %CCSHARED% %CCFLAGS% %CCOUT%$(SRC)/ft6_glyphslot%O% $(SRC)/ft6_glyphslot.c %LIB-CFLAGS% $(CF)

doc : README.md doc/BitMap.md doc/CharMap.md doc/Face.md doc/Glyph.md doc/GlyphImage.md doc/Outline.md doc/NamedInfo.md doc/Native.md doc/Native/Defs.md

README.md : lib/Font/FreeType.rakumod
	(\
	    echo '[![Build Status](https://travis-ci.org/p6-pdf/Font-FreeType-raku.svg?branch=master)](https://travis-ci.org/p6-pdf/Font-FreeType-raku)'; \
            echo '';\
            perl6 -I . --doc=Markdown lib/Font/FreeType.rakumod\
        ) > README.md

doc/BitMap.md : lib/Font/FreeType/BitMap.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/BitMap.rakumod > doc/BitMap.md

doc/CharMap.md : lib/Font/FreeType/CharMap.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/CharMap.rakumod > doc/CharMap.md

doc/Face.md : lib/Font/FreeType/Face.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/Face.rakumod > doc/Face.md

doc/Glyph.md : lib/Font/FreeType/Glyph.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/Glyph.rakumod > doc/Glyph.md

doc/GlyphImage.md : lib/Font/FreeType/GlyphImage.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/GlyphImage.rakumod > doc/GlyphImage.md

doc/NamedInfo.md : lib/Font/FreeType/NamedInfo.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/NamedInfo.rakumod > doc/NamedInfo.md

doc/Outline.md : lib/Font/FreeType/Outline.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/Outline.rakumod > doc/Outline.md

doc/Native.md : lib/Font/FreeType/Native.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/Native.rakumod > doc/Native.md

doc/Native/Defs.md : lib/Font/FreeType/Native/Defs.rakumod
	perl6 -I . --doc=Markdown lib/Font/FreeType/Native/Defs.rakumod > doc/Native/Defs.md

test : all
	@prove -e"perl6 -I ." t

loudtest : all
	@prove -e"perl6 -I ." -v t

clean :
	@rm -f $(SRC)/ft6_*%O% resources/libraries/*%LIB-NAME%

realclean : clean
	@rm -f Makefile README.md doc/*.md doc/*/*.md


